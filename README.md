# api-generator
This repo is responsible for generating an OpenAPI specification for the Onshape API based on the JSON definition pulled from the Endpoints endpoint. During that process, it incorporates the various endpoint definitions hand written in OnshapeOpenApiSpecTemplate.yaml. 

The most up-to-date version of the spec can always be found [here](https://github.com/onshape-public/api-generator/releases/latest).

Additionally, this repo is responsible for notifying various clients when the OpenAPI specification is published. Notification consists of uploading an "api.yaml" file that declares the API version and the link to the relevant OpenAPI link like this:

```YAML
version: 1.87
openApiSpec: https://github.com/onshape-public/api-generator

```
## Incorporating the client with CI tools
The file is uploaded to the master branch of each of the clients. Each is responsible for taking the file and using it to update the relevant client. In general, the Travis file should perform the following:
1. Load information from the api.yaml file into the environment
2. Use the loaded information to build the client with swagger_codegen
3. Perform additional massages as needed to make the client work (should be something like a short script with some regex)
4. Test the client against some static tests to ensure against regressions
5. If the tests pass, tag the current commit with the given API version number and push the tag
6. Now that it is tagged, skip earlier steps, and run the deploy task to publish the client to the relevant package repository (pip, npm, etc...)

 ## Adding new Endpoints and Replacing the JSON with OpenAPI definitions
This repo has built in mechanisms to aid with the incremental transition from the Onshape JSON API definition to a OpenAPI definition. Parser starts with a valid OpenAPI template located here: OnshapeOpenApiSpecTemplate.yaml (from now on referred to as 'the template'). The parser then injects various paths and models that aren't already defined into the template. Therefore, by including the path manually within the template, we can use the hand written model/path rather than the one generated by the parser. In general, this process looks like:

1. (If replacing an endpoint that already exists) Run the parser to copy the current autogenerated OpenAPI definition for the model/path to be replaced.
2. (If replacing an endpoint that already exists) Paste the generated model/path into the template
3. Paste the template into the [Swagger editor](http://editor.swagger.io/) and change the inserted model/path to your liking.
4. Use the template to generate the server side interfaces, stub methods and test methods. This can be done using Swagger codegen. 
5. Publish the new template and the new server code.
6. Congratulations! You've updated/added some endpoints! 

